# Ships 
Учебный проект, реализация HTTP API для осуществления базовых CRUD операций над единственной сущностью.

## Задача
Сущность Ship имеет следующие поля:
* Long id;
* String name - название (от 1 до 50 знаков включительно);
* String planet - планета создания (от 1 до 50 знаков включительно)
* ShipType shipType - тип корабля (определены в src/main/java/com/tixthefox/ShipType.java);
* Date prodDate - дата выпуска (от 2800 до 3019 годов включительно);
* Boolean isUsed - использованный / новый;
* Double speed - максимальная скорость корабля (от 0.01 до 0.99 включительно, точность - 2 знака после запятой)
* Integer crewSize - количество членов экипажа (от 1 до 9999 включительно).
* Double rating - рейтинг корабля, точность - два знака после запятой.

Рейтинг рассчитывается при добавлении/изменении корабля по формуле $r = 80 * v * k / (y0 - y1 + 1)$, где:
* v - максимальная скорость корабля;
* k - коэффициент, равный 1, если корабль новый, 0.5 иначе;
* y0 - текущий год (задан как 3019);
* y1 - год выпуска корабля.

Для данной сущности нужно было реализовать следующие операции:
1. Получить список всех кораблей (с возможностью фильтрации по всем полям)
2. Получить количество кораблей (так же с фильтрацией)
3. Создать новый корабль
4. Получить корабль по ID
5. Удалить корабль по ID
6. Изменить характеристики существующего корабля (по ID)

Полное описание запросов, их параметров, ответов приведено в папке task.

Доп. детали задания:
* В запросе на создание корабля поле isUsed указывать не обязательно, при этом значение по умолчанию - false;
* Время (prodDate) передается в миллисекундах относительно Epoch Time;
* id и rating, очевидно, пользователь менять не может

## Заметки о реализации
Решение использует:
* Spring Boot как основной фреймворк решения, **включает встроенный сервер для запуска**;
* Spring Data JPA для взаимодействия с базой данных;
* PostgreSQL в качестве БД (по крайней мере, в зависимостях прописан драйвер для postgres, и скрипт sql/base_init.sql для инициализации таблицы подразумевает использование PostgreSQL);
* Maven в качестве системы сборки и управления зависимостями.

В проекте применяются:
* DTO (data transfer object) как структуры данных для обмена информацией между клиентом и сервером. Маппинг Entity-DTO реализован вручную;
* DAO (data access object) как точку для взаимодействия с сущностью Ship;
* Service Layer, инкапсулирующий бизнес-логику (в частности, расчет рейтинга, проверку валидности сохраняемых объектов);
* ControllerAdvice объект для обработки исключений. Исключения являются основным механизмом для сообщений о проблемах (например, о невалидности параметров, или о том, что корабля с заданным id не существует); 
* Criteria API (в частности Predicate) для составления запросов с фильтрами (в которых много опциональных параметров)

По заданию для список предполагается пагинация. **На данный момент пагинации в запросах нет**.

## Сборка и запуск
Для сборки приложения использовались:
* Java 17
* Maven 3.9.11
Остальные зависимости указаны в pom.xml
Для сборки достаточно вызвать команду 
```
mvn clean package -DskipTests
```
jar-файл CosmoportBoot-1.0.jar будет собран в директорию target, откуда его можно запустить командой
```
java -jar target/CosmoportBoot-1.0.jar 
```
API будет доступен локально по адресу `localhost:8080/api/`

## Тесты
Для проекта были написаны интеграционные тесты, использующие в качестве базы данных H2. Для запуска тестов достаточно вызвать команду:
```
mvn test
```

## TODO
В дальнейшем планируется:
* Добавить пагинацию согласно заданию
* Создать DTO или аналог для фильтров при GetAll и Count запросах (с целью инкапсуляции проверки параметров)
* Перейти в запросах с фильтрами с Predicate на Specifications